<!DOCTYPE html>
<html lang="en">
<head>
        <title>haridas.in - security</title>
        <meta charset="utf-8" />
        <link rel="stylesheet" href=".././theme/css/main.css" type="text/css" />
        <link href=".././feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="haridas.in ATOM Feed" />
        

        <!--[if IE]>
                <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

        <!--[if lte IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href=".././css/ie.css"/>
                <script src=".././js/IE8.js" type="text/javascript"></script><![endif]-->

        <!--[if lt IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href=".././css/ie6.css"/><![endif]-->

</head>

<body id="index" class="home">

<a href="http://github.com/haridas">

<img style="position: absolute; top: 0; right: 0; border: 0;" src="http://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png" alt="Fork me on GitHub" />

</a>

        <header id="banner" class="body">
                <h1><a href="../.">haridas.in </a></h1>
                <nav><ul>
                
                    <li><a href="/archives.html">Archives</a></li>
                
                
                
                    <li><a href=".././pages/about-me.html">About Me</a></li>
                
                
                
                    <li ><a href=".././category/blog.html">blog</a></li>
                
                </ul></nav>
        </header><!-- /#banner -->
                

            

        
        
            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href=".././how-to-put-encrypted-contents-on-cloud-storages.html">How to put Encrypted Contents on Cloud Storages</a></h1> 
                    <footer class="post-info">
        <abbr class="published" title="2012-07-27T00:00:00">
                Fri 27 July 2012
        </abbr>

        
        <address class="vcard author">
                By <a class="url fn" href=".././author/haridas.html">haridas</a>
        </address>
        
<p>In <a href=".././category/blog.html">blog</a>. </p>
<p>tags: <a href=".././tag/security.html">security</a><a href=".././tag/server.html">server</a></p>


</footer><!-- /.post-info --><p>There is a plenty of cloud storage services out there for free.
It's very convenient and flexible that we can sync our local files with
remote storage. For simple and non-sensitive contents this  is very useful.
But we know that the contents on the net are being open. There is a chance for
those contents will get read by others.</p>
<p>I use Dropbox with my Debian machine to sync my local documents.
But I'm worried about putting some of my documents on the cloud after
knowing that there is a chance of breach. Because of that I avoided putting
those contents on my cloud storage. Later I figured out that we can
put an encrypted contents. I tried to use GPG and other methods to encrypt
the contents and putting them on cloud. But those are all requires lot of work to
push contents each time. GPG mainly used for transferring encrypted contents
between sender and receiver, so that is not the good solution. We required
a method to add the encrypted documents only to our cloud storage and the same
time we want to access the actual copy of the document on our machine.</p>
<p>Then I saw options for the ecrypted file systems like <strong>ecryptfs</strong>,
<strong>encfs</strong> are available under Linux file systems. Which provide
good flexibility that I required, and it only required pain of one time setup.</p>
<p><em>encfs</em> is a User space filesystem, but the <em>ecryptfs</em> is working in the kernel space,
because of that ecryptfs is little difficult to setup. But ecryptfs is faster
and more secure than the encfs. Both of them using a passphrase as the initial
key to do all the encryption and decryption, we can keep this
passphrase with other file systems or even in external storage device, This is like
normal password required to initiate the encryption or decryption.</p>
<p>Here I'm explaining how to use the ecryptfs,</p>
<p>First install the packages required,</p>
<p>From root user follow these commands.</p>
<div class="highlight"><pre><span class="gp">#</span>apt-get install ecryptfs-utils
<span class="gp">#</span>modprobe cryptfs
</pre></div>
<p>I'm using Dropbox as my cloud storage. So inside your drobox folder just create
one folder named Encrypted.</p>
<div class="highlight"><pre><span class="gp">$</span> mkdir ~/Dropbox/Encrypted
<span class="gp">$</span> mkdir ~/SecureDropbox
</pre></div>
<p>We are going to keep our documents under the ~/SecureDropbox folder, and the
ecryptfs will generate the corresponding encrypted files on the
~/Dropbox/Encrypted folder. So Dropbox only see this Encrypted files.</p>
<p>Actually in terms of ecryptfs the ~/Dropbox/Encrypted act as an encrypted
file system partition(like /dev/sda5) and the ~/SecureDrobox act as the mount
point where we can see the actual content of the files, we require the proper
passphrase to mount the encrypted file system to local folder.This mounting and
creation of the encrypted file system is explained bellow.</p>
<p>To mount the encrypted device to the mount point, use the normal mount command
with ecryptfs as its filesystem. This step ask for set of questions.</p>
<div class="highlight"><pre><span class="c"># Mount command requires root privilage.</span>
mount -t ecryptfs /home/haridas/Dropbox/Encrypted /home/haridas/SecureDropbox
</pre></div>
<p>Check this console page to see the complete list of commands required to finish
the mounting operation.</p>
<img alt="/images/encryption-3.jpg" src="../static/images/encryption-3.jpg" />
<p>Now check the filesystem to see whether the encrypted filesystem got mounted
to the mount point, use df command.</p>
<div class="highlight"><pre><span class="gp">#</span> df -h
</pre></div>
<p>So if there is no error, you can now check for the file encryption by directly
adding one text file in to <cite>/home/haridas/SecureDropbox</cite>, immediately you can see
the encrypted file with the same name under <cite>/home/haridas/Dropbox/Encrypted</cite>.
Try out this.</p>
<p>So we are done with the keeping only the encrypted files under Dropbox folder.
So don't need to worry about the sensitive documents. But one thing is that in
order to decrypt the files from other machines, you required the passphrase and
other machines should support the ecryptfs. You can't us mobile
devices to view the encrypted content.</p>
<p>We need to mount the ecryptefs filesystem in the boot time to avoid that step
every time. That requires passphrase, and set of other configurations, that was
done while mounting the file system initially. We can pass this automatically by
putting it in a <cite>.ecryptfsrc</cite> file under root home directory. So at boot time
we can see system can read it.</p>
<p>The <cite>/root/.ecryptfsrc</cite> file should have the following lines</p>
<div class="highlight"><pre>key=passphrase:passphrase_passwd_file=/home/haridas/.ecryptfs/.secret-passphrase.txt
ecryptfs_sig=b2f118ee01beb78b
ecryptfs_cipher=aes
ecryptfs_key_bytes=32
ecryptfs_passthrough=n
ecryptfs_enable_filename_crypto=n
</pre></div>
<p>After creating /root/.ecryptfsrc file, add the following line to <cite>/etc/fstab</cite>
to automount at boot time.</p>
<div class="highlight"><pre><span class="sr">/home/</span>haridas<span class="sr">/Dropbox/</span>Encrypted <span class="sr">/home/</span>haridas/SecureDropbox  ecryptfs
defaults <span class="m">0</span> <span class="m">0</span>
</pre></div>
<p>The passphrase is the important thing that you have to keep in your machine or
with external disk. Make sure that the passphrase is available to the system
when you are trying to mount it in the booting time itself.</p>
<p>Keep the passphrase safe !. Which determines the strength of your encryption.</p>
<p>Enjoy.</p>
<p>There are <a href=".././how-to-put-encrypted-contents-on-cloud-storages.html#disqus_thread">comments</a>.</p>
                </article>
                
                    
<p class="paginator">
    
    Page 1 / 1
    
</p>

                
            </aside><!-- /#featured -->
            
        
        
        

    


        <section id="extras" class="body">
        
                <div class="blogroll">
                        <h2>blogroll</h2>
                        <ul>
                        
                            <li><a href="http://docs.notmyidea.org/alexis/pelican/">Pelican</a></li>
                        
                            <li><a href="http://python.org">Python.org</a></li>
                        
                        </ul>
                </div><!-- /.blogroll -->
        
        
                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href=".././feeds/all.atom.xml" rel="alternate">atom feed</a></li>
                            

                        
                            <li><a href="http://twitter.com/haridas_n">twitter</a></li>
                        
                            <li><a href="http://github.com/haridas">github</a></li>
                        
                            <li><a href="http://in.linkedin.com/pub/haridas-n/19/95/825">linkedin</a></li>
                        
                        </ul>
                </div><!-- /.social -->
        
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://alexis.notmyidea.org/pelican/">pelican</a>, which takes great advantages of <a href="http://python.org">python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
        var pageTracker = _gat._getTracker("UA-23592173-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>



<script type="text/javascript">
    var disqus_shortname = 'haridas';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>

</body>
</html>