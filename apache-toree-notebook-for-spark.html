<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="HN, ">

        <link rel="alternate"  href="https://haridas.in/feeds/all.atom.xml" type="application/atom+xml" title="HN Full Atom Feed"/>

    <title>Apache Toree notebook for Spark // all posts // HN </title>


    <link href='http://fonts.googleapis.com/css?family=PT+Mono|PT+Serif|PT+Sans' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="https://haridas.in/theme/css/pure.css">
    <link rel="stylesheet" href="https://haridas.in/theme/css/asciidoctor.css">

    <link rel="stylesheet" href="https://haridas.in/theme/css/pygments.css">

    <script src="//cdnjs.cloudflare.com/ajax/libs/fitvids/1.0.1/jquery.fitvids.min.js"></script>
    <script>
        $(document).ready(function(){
            $(".content").fitVids();
        });
    </script>
</head>

<body>
    <div class="container">

            <div class="container-header">
            </div>


            <div class="container-body">

                    <div class="body-sidebar">
                        <header class="content-sidebar">

                            <hgroup>

                                <img class="avatar" src="https://haridas.in/images/profile_pic.jpg">

                                <h1 class="brand-main"><a href="https://haridas.in">HN</a></h1>


                                            <p class="links">
                                                <a href="https://haridas.in/category/programming.html">Programming
                                                </a>
                                            </p>
                                            <p class="links">
                                                <a href="https://haridas.in/category/data-science.html">Data-Science
                                                </a>
                                            </p>
                                            <p class="links">
                                                <a href="https://haridas.in/tag/security.html">Security
                                                </a>
                                            </p>
                                            <p class="links">
                                                <a href="https://haridas.in/category/devops.html">Devops
                                                </a>
                                            </p>
                                            <p class="links">
                                                <a href="https://gist.github.com/haridas">Gists
                                                </a>
                                            </p>
                                            <p class="links">
                                                <a href="https://haridas.in/pages/about-me.html">About Me
                                                </a>
                                            </p>
                                            <p class="links">
                                                <a href="https://haridas.in/resume.pdf">Resume
                                                </a>
                                            </p>
                                <p class="social">
                                        <a href="http://twitter.com/haridas_n">
                                                <img src="https://haridas.in/images/tt.svg" alt="menu icon" width="48" height="48" />
                                        </a>
                                        <a href="http://github.com/haridas">
                                                <img src="https://haridas.in/images/github.svg" alt="menu icon" width="45" height="45" />
                                        </a>
                                        <a href="https://linkedin.com/in/haridasn">
                                                <img src="https://haridas.in/images/linkedin.svg" alt="menu icon" width="48" height="48" />
                                        </a>
                                </p>
                            </hgroup>
                    </header>

                    </div>


                    <div class="body-column">
    <div class="content">
        <div class="column">
            <section class="post">
                <header class="post-header">
                    <h1 class="article-title">Apache Toree notebook for Spark</h1>
                        <p class="post-meta">
                            Tags:                                 <a class="post-category" href="https://haridas.in/tag/apache-spark.html">apache-spark</a>
                                <a class="post-category" href="https://haridas.in/tag/apache-toree.html">apache-toree</a>
                        </p>


<a href="http://twitter.com/share" class="twitter-share-button" data-count="horizontal" data-via="haridas_n">
    Tweet
</a>

<script type="text/javascript" src="http://platform.twitter.com/widgets.js"></script>

<!-- Place this tag where you want the +1 button to render. -->
<div class="g-plusone" data-size="medium"></div>

<!-- Place this tag after the last +1 button tag. -->
<script type="text/javascript">
  (function() {
       var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
           po.src = 'https://apis.google.com/js/platform.js';
               var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
                 })();
</script>                        <p class="post-date">
                            in <a href="https://haridas.in/category/data-science.html">data-science</a> &middot; Sun 09 December 2018
                        </p>
                </header>
            </section>
            <div class="paragraph">
<p>Apache Toree is a jupyter kernel. It runs the spark application in client mode,
so that we can interact with the application via console. By enabling this in
standard jupyter notebook we can easily connect with any spark cluster or standalone servers,
via this we get all the flexibility of the jupyter notebook. Toree notebook supports
pyspark and R also with special magic constructs.</p>
</div>
<div class="paragraph">
<p>Here I&#8217;m explaining how we can install and configure toree for spark based testing
environment.</p>
</div>
<div class="sect1">
<h2 id="_how_to_configure_toree_with_default_jupyter_notebook">How to configure toree with default jupyter notebook</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash"># Current latest version, pick the
pip install toree==0.3.0
jupyter toree install --user --spark_home=/mnt/haridas/packages/spark-2.1.2-bin-hadoop2.7</code></pre>
</div>
</div>
<div class="paragraph">
<p>To confirm the new kernel got installed to jupyter correctly,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">jupyter kernelspec list

Available kernels:
  apache_toree_scala    /home/haridas/.local/share/jupyter/kernels/apache_toree_scala
  python3               /home/haridas/ENV3/share/jupyter/kernels/python3</code></pre>
</div>
</div>
<div class="paragraph">
<p>If above commands ran successful then we are good to go with running new kernel
with jupyter web UI or on the console mode.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_access_the_toree_via_jupyter">Access the Toree via jupyter</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_notebook_mode">Notebook mode</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">jupyter notebook --no-browser --ip 0.0.0.0 --port 8080</code></pre>
</div>
</div>
<div class="paragraph">
<p>Go to browser on this jupyter application, when creating the new notebook, you
can now have option to create toree notebook also along with python standard notebook
type.</p>
</div>
</div>
<div class="sect2">
<h3 id="_console_mode">Console mode</h3>
<div class="paragraph">
<p>Sometime you might need to directly work on small scripts ore test few things against
spark cluster or checking the scala magics ;)</p>
</div>
<div class="paragraph">
<p>Make use of the console version jupyter with the new kernel. Now you get the standard
ipython like console via that we can interact with the spark cluster or write scala
codes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>jupyter console --kernel=apache_toree_scala</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_customie_toree_configuration">Customie toree configuration</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Default settings of the spark application is very minimal, which may be not enough
to test with big files or make use of the available resources in your machine. To
do that you need to update the default configurations.</p>
</div>
<div class="paragraph">
<p>By default spark and driver program make uses only 1GB of heap size, and number
of executors will be 1.</p>
</div>
<div class="paragraph">
<p>To change the configuration it&#8217;s pretty easy, you can check the available options
from  <code>spark-submit --help</code> command, and pass them on bellow environment variable
before running the toree notebook.</p>
</div>
<div class="paragraph">
<p>When picking options from <code>spark-submit</code> ensure your cluster is of type standalone,
or standalone-cluster-mode or yarn cluster mode. The options are bit different between
the cluster managers.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">export SPARK_OPTS="--jars /home/haridas/custom1.jar:/home/haridas/custom2.jar \
    --driver-memory=5g \
    --executor-memory=5g \
    --num-executors 3"
jupyter console --kernel=apache_toree_scala</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_connect_toree_with_remote_spark_cluster">Connect Toree with remote spark cluster</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Here only we only need to make use of the spark-submit arguments.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">export SPARK_OPTS="--master spark://&lt;host&gt;:7077 ..."</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_write_sqlpythonr_on_the_same_toree_notebook">Write SQL/python/R on the same toree notebook</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By making use of the special magic types you can run the any of these codes that
is supported by the spark execution environment.</p>
</div>
<div class="paragraph">
<p><a href="https://datasciencemadesimpler.wordpress.com/tag/toree/" class="bare">https://datasciencemadesimpler.wordpress.com/tag/toree/</a></p>
</div>
<div class="paragraph">
<p>Thats all for now, have fun with spark cluster and get the same flexibility of ipython notebook !</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_pyspark_as_ipython">Pyspark as ipython</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">export SPARK_HOME=/mnt/haridas/RPX/packages/spark-2.4.0-bin-hadoop2.7
export PATH=$SPARK_HOME/bin:$PATH
export PYSPARK_DRIVER_PYTHON=/home/haridas/ENV3/bin/jupyter
export PYSPARK_DRIVER_PYTHON_OPTS='console'


pyspark</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now the pyspark uses the jupyter console interface, works with</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_start_spark_workers_in_standalone_mode_with_multiple_worker_per_node">Start spark workers in standalone mode with multiple worker per node.</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://jaceklaskowski.gitbooks.io/mastering-apache-spark/spark-standalone-example-2-workers-on-1-node-cluster.html" class="bare">https://jaceklaskowski.gitbooks.io/mastering-apache-spark/spark-standalone-example-2-workers-on-1-node-cluster.html</a></p>
</div>
<div class="paragraph">
<p>Standalone mode,</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>worker can have multiple executor.</p>
</li>
<li>
<p>Worker is like node manager in yarn.</p>
</li>
<li>
<p>We can set worker max core and memory usage setting.</p>
</li>
<li>
<p>When defining the spark application via spark-shell or so, define the executor
memory and cores.</p>
<div class="literalblock">
<div class="content">
<pre>eg; worker-1 has 10 core and 20gb memory</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>When submitting the job to get 10 executor with 1 cpu and 2gb ram each,</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>spark-submit --execture-cores 1 --executor-memory 2g --master &lt;url&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_reference">Reference</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="https://blog.cloudera.com/blog/2014/05/apache-spark-resource-management-and-yarn-app-models/" class="bare">https://blog.cloudera.com/blog/2014/05/apache-spark-resource-management-and-yarn-app-models/</a></p>
</li>
<li>
<p><code>spark-submit --help</code> command.</p>
</li>
<li>
<p><a href="https://toree.apache.org/" class="bare">https://toree.apache.org/</a></p>
</li>
<li>
<p><a href="https://github.com/apache/incubator-toree/blob/master/etc/examples/notebooks/magic-tutorial.ipynb" class="bare">https://github.com/apache/incubator-toree/blob/master/etc/examples/notebooks/magic-tutorial.ipynb</a></p>
</li>
</ol>
</div>
</div>
</div>

            <a href="#" class="go-top">Go Top</a>
    <div class="comments">

        <!-- <div id="disqus_thread"></div> -->

        <div id="disqus_thread">
            <a href="#" class="comments-holder" onclick="loadDisqus();return false;">Show/Post Comments</a> 
        </div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = "haridas"; // required: replace example with your forum shortname

            /* * * DON'T EDIT BELOW THIS LINE * * */
            var loadDisqus = function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            };
        </script>

        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

        <!-- <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a> -->
    </div>
        </div>
    </div>
                    </div>

            </div>

            <div class="container-footer">
<footer class="footer">
                <a href="http://twitter.com/haridas_n"> Twitter</a> |
                <a href="http://github.com/haridas"> Github</a> |
                <a href="https://linkedin.com/in/haridasn"> Linkedin</a>
        &ndash;
        &copy; HN &ndash;
        <i> <a href="https://github.com/haridas/hn-theme">Built with HN Theme</a> </i>
        for <a href="http://blog.getpelican.com/">Pelican</a>
</footer>            </div>

    </div>

    <script>
        var $top = $('.go-top');

        // Show or hide the sticky footer button
        $(window).scroll(function() {
            if ($(this).scrollTop() > 200) {
                $top.fadeIn(200);
            } else {
                $top.fadeOut(200);
            }
        });

        // Animate the scroll to top
        $top.click(function(event) {
            event.preventDefault();
            $('html, body').animate({scrollTop: 0}, 300);
        })

        // Makes sure that the href="#" attached to the <a> elements
        // don't scroll you back up the page.
        $('body').on('click', 'a[href="#"]', function(event) {
            event.preventDefault();
        });
    </script>
    <!--
    <script type="text/javascript">
        var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
        document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
        try {
            var pageTracker = _gat._getTracker("UA-23592173-1");
            pageTracker._trackPageview();
            } catch(err) {}
    </script>
    -->

    <script type="text/javascript">

      var _gaq = _gaq || [];
          _gaq.push(['_setAccount', 'UA-23592173-1']);
          _gaq.push(['_trackPageview']);

    (function() {
     var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
     ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
         var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
       })();

    </script>

</body>
</html>