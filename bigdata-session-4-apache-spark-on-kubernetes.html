<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="HN, ">

        <link rel="alternate"  href="https://haridas.in/feeds/all.atom.xml" type="application/atom+xml" title="HN Full Atom Feed"/>

    <title>Bigdata Session 4 - Apache Spark on Kubernetes // all posts // HN </title>


    <link href='https://fonts.googleapis.com/css?family=PT+Mono|PT+Serif|PT+Sans' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="https://haridas.in/theme/css/pure.css">
    <link rel="stylesheet" href="https://haridas.in/theme/css/asciidoctor.css">
    <link rel="stylesheet" href="https://haridas.in/theme/css/pymdext.css">

    <link rel="stylesheet" href="https://haridas.in/theme/css/pygments.css">

    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/fitvids/1.2.0/jquery.fitvids.js"></script>
    <script>
        $(document).ready(function(){
            $(".content").fitVids();
        });
    </script>
	<script src="https://haridas.in/theme/js/pymdext.js"></script>
</head>

<body>
    <div class="container">

            <div class="container-header">
            </div>


            <div class="container-body">

                    <div class="body-sidebar">
                        <header class="content-sidebar">

                            <hgroup>

                                <img class="avatar" src="https://haridas.in/images/profile_pic.jpg">

                                <h1 class="brand-main"><a href="https://haridas.in">HN</a></h1>


                                            <p class="links">
                                                <a href="https://haridas.in/category/programming.html">Programming
                                                </a>
                                            </p>
                                            <p class="links">
                                                <a href="https://haridas.in/category/data-science.html">Data-Science
                                                </a>
                                            </p>
                                            <p class="links">
                                                <a href="https://haridas.in/category/devops.html">DevOps
                                                </a>
                                            </p>
                                            <p class="links">
                                                <a href="https://haridas.in/pages/my-talks.html">Talks
                                                </a>
                                            </p>
                                            <p class="links">
                                                <a href="https://haridas.in/pages/about-me.html">About Me
                                                </a>
                                            </p>
                                            <p class="links">
                                                <a href="https://haridas.in/resume.pdf">Resume
                                                </a>
                                            </p>
                                <p class="social">
                                        <a href="https://twitter.com/haridas_n">
                                                <img src="https://haridas.in/images/tt.svg" alt="menu icon" width="48" height="48" />
                                        </a>
                                        <a href="https://github.com/haridas">
                                                <img src="https://haridas.in/images/github.svg" alt="menu icon" width="45" height="45" />
                                        </a>
                                        <a href="https://linkedin.com/in/haridasn">
                                                <img src="https://haridas.in/images/linkedin.svg" alt="menu icon" width="48" height="48" />
                                        </a>
                                </p>
                            </hgroup>
                    </header>

                    </div>


                    <div class="body-column">
    <div class="content">
        <div class="column">
            <section class="post">
                <header class="post-header">
                    <h1 class="article-title">Bigdata Session 4 - Apache Spark on Kubernetes</h1>
                        <p class="post-meta">
                            Tags:                                 <a class="post-category" href="https://haridas.in/tag/hadoop.html">hadoop</a>
                                <a class="post-category" href="https://haridas.in/tag/spark.html">spark</a>
                                <a class="post-category" href="https://haridas.in/tag/drill.html">drill</a>
                                <a class="post-category" href="https://haridas.in/tag/kubernetes.html">kubernetes</a>
                        </p>


<a href="https://twitter.com/share" class="twitter-share-button" data-count="horizontal" data-via="haridas_n">
    Tweet
</a>

<script type="text/javascript" src="https://platform.twitter.com/widgets.js"></script>

<!-- Place this tag where you want the +1 button to render. -->
<div class="g-plusone" data-size="medium"></div>

<!-- Place this tag after the last +1 button tag. -->
<script type="text/javascript">
  (function() {
       var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
           po.src = 'https://apis.google.com/js/platform.js';
               var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
                 })();
</script>                        <p class="post-date">
                            in <a href="https://haridas.in/category/data-science.html">data-science</a> &middot; Sun 02 June 2019
                        </p>
                </header>
            </section>
            <div class="paragraph">
<p>This is a series of blog posts about the 4 sessions I conducted at different engineering
colleges.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Bigdata Session 1 - Apache Hadoop</p>
</li>
<li>
<p>Bigdata Session 2 - Apache Spark on Apache Hadoop</p>
</li>
<li>
<p>Bigdata Session 3 - Apache Drill</p>
</li>
<li>
<p>Bigdata Session 4 - Apache Spark on Kubernetes &#8592; ( You are here now )</p>
</li>
</ol>
</div>
<div class="sect1">
<h2 id="_spark_on_kubernetes">1. Spark on Kubernetes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Kubernetes is a Linux container manager, the ideas are similar to how yarn manages the
jvm containers in the Hadoop environment. Kubernetes can be used to deploy very heterogeneous workloads, and it can meet the requirements of an entire business. eg; Deploy applications, dev/stage environments, offline or batch processing services, etc. As the Hadoop
environment is specific to bigdata processing, here we can use the existing kubernetes
cluster to do the things that we did on the hadoop cluster or spark cluster.</p>
</div>
<div class="paragraph">
<p>This tutorial covers how we can quickly set up a kubernetes cluster and deploy a
spark cluster on it so that then we can play on spark. The kubernetes act as one
of the spark&#8217;s cluster manager, there is no change in other aspects of how spark
does its functionalities.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_setup_spark_on_kubernetes">2. Setup spark on kubernetes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Kubernetes can be deployed in a multi-node or single node environment similar to
a hadoop cluster. Here we try the kubernetes set up on a VM.</p>
</div>
<div class="paragraph">
<p>We will be using the <code>minikube</code> tool to set up a kubernetes cluster. Minikube provides an easy way to set up a Kubernetes cluster on a VM for testing and experiment purposes.</p>
</div>
<div class="sect2">
<h3 id="_gnulinux_environment">2.1. Gnu/Linux Environment:-</h3>
<div class="ulist">
<ul>
<li>
<p>Install VirtualBox</p>
</li>
<li>
<p>Follow this link to install minikube <a href="https://kubernetes.io/docs/tasks/tools/install-minikube/#install-minikube" class="bare">https://kubernetes.io/docs/tasks/tools/install-minikube/#install-minikube</a></p>
</li>
<li>
<p>Install kubectl - <a href="https://kubernetes.io/docs/tasks/tools/install-kubectl/#install-kubectl-binary-using-native-package-management" class="bare">https://kubernetes.io/docs/tasks/tools/install-kubectl/#install-kubectl-binary-using-native-package-management</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Start the minikube to launch the kubernetes cluster.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">minikube start --cpus 3 --memory 6000</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_mac_environment">2.2. Mac environment:-</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">brew cask install minikube
brew install docker-machine-driver-hyperkit
minikube start --vm-driver hyperkit --cpus 3 --memory 6000</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>kubectl</code> command available in mac if you already have the docker installed.</p>
</div>
</div>
<div class="sect2">
<h3 id="_test_kubernetes_cluster_is_up">2.3. Test kubernetes cluster is up</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl cluster-info</code></pre>
</div>
</div>
<div class="paragraph">
<p>Copy the master URL, we need it below to submit spark jobs.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl create namespace spark1
kubectl create serviceaccount jumppod -n spark1
kubectl create rolebinding jumppod-rb --clusterrole=admin --serviceaccount=spark1:jumppod -n spark1
kubectl run jump-1 -ti --rm=true -n spark1 --image=brainlounge/jumppod:ubuntu-18.04 --serviceaccount='jumppod'</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ensure_you_have_jdk_1_8_installed_on_your_laptop">2.4. Ensure you have JDK 1.8 installed on your laptop</h3>

</div>
<div class="sect2">
<h3 id="_prepare_spark_container_images_for_kubernetes_cluster">2.5. Prepare spark container images for kubernetes cluster</h3>
<div class="paragraph">
<p>Kubernetes is a container manager or orchestrator, we need to package the spark in
docker image form to deploy them on a Kubernetes cluster.
<code>spark-submit</code> command supports the spark job submission into kubernetes cluster
by just changing the <code>--master url</code></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Run this after the kubernetes cluster is up.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash"># Download a copy of the spark binary into your laptop and build the docker
# image from it.
wget http://mirrors.estointernet.in/apache/spark/spark-2.4.0/spark-2.4.0-bin-hadoop2.7.tgz
cd spark-2.4.0-bin-hadoop2.7
./bin/docker-image-tool.sh -m -t 2.4.0 build</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_start_a_spark_client_on_kubernetes_cluster_manager">2.6. Start a spark client on kubernetes cluster manager</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash"># Get the kubernetes master url, will be in this form 'https://&lt;host:port&gt;'.
minikube cluster-info

cd spark-2.4.0-bin-hadoop2.7
./bin/spark-shell --master k8s://https://&lt;host:port&gt; --name spark-kube-cli --deploy-mode client \
    --conf spark.kubernetes.container.image=spark:2.4.0</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we can try with all the spark command features available, only change here
is the <code>--master</code> param and extra <code>--conf</code> with image name for the spark.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_spark_on_kubernetes">3. Why spark on kubernetes</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Kubernetes can work with a wide variety of application clusters, your entire application
stack it can host.</p>
</li>
<li>
<p>Easy to deploy and manage different types of applications and their different stages.</p>
</li>
<li>
<p>If you have a kubernetes cluster in your infrastructure, this is the best option available to run a spark.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_presentation">4. Presentation</h2>
<div class="sectionbody">
<iframe src="//www.slideshare.net/slideshow/embed_code/key/sRm6qq2Fdaplhk" width="595" height="485" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC; border-width:1px; margin-bottom:5px; max-width: 100%;" allowfullscreen> </iframe> <div style="margin-bottom:5px"> <strong> <a href="//www.slideshare.net/haridasnss/apache-spark-on-kubernetes" title="Apache Spark on Kubernetes" target="_blank">Apache Spark on Kubernetes</a> </strong> from <strong><a href="https://www.slideshare.net/haridasnss" target="_blank">haridasnss</a></strong> </div>
</div>
</div>
            <a href="#" class="go-top">Go Top</a>
    <div class="comments">

        <!-- <div id="disqus_thread"></div> -->

        <div id="disqus_thread">
            <a href="#" class="comments-holder" onclick="loadDisqus();return false;">Show/Post Comments</a> 
        </div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = "haridas"; // required: replace example with your forum shortname

            /* * * DON'T EDIT BELOW THIS LINE * * */
            var loadDisqus = function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            };
        </script>

        <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

    </div>
        </div>
    </div>
                    </div>

            </div>

            <div class="container-footer">
<footer class="footer">
                <a href="https://twitter.com/haridas_n"> Twitter</a> |
                <a href="https://github.com/haridas"> Github</a> |
                <a href="https://linkedin.com/in/haridasn"> Linkedin</a>
        &ndash;
        &copy; HN &ndash;
        <i> <a href="https://github.com/haridas/hn-theme">Built with HN Theme</a> </i>
        for <a href="https://blog.getpelican.com/">Pelican</a>
</footer>            </div>

    </div>
    <script>
        var $top = $('.go-top');

        // Show or hide the sticky footer button
        $(window).scroll(function() {
            if ($(this).scrollTop() > 200) {
                $top.fadeIn(200);
            } else {
                $top.fadeOut(200);
            }
        });

        // Animate the scroll to top
        $top.click(function(event) {
            event.preventDefault();
            $('html, body').animate({scrollTop: 0}, 300);
        })

        // Makes sure that the href="#" attached to the <a> elements
        // don't scroll you back up the page.
        $('body').on('click', 'a[href="#"]', function(event) {
            event.preventDefault();
        });
    </script>
    <script type="text/javascript">

      var _gaq = _gaq || [];
          _gaq.push(['_setAccount', 'UA-23592173-1']);
          _gaq.push(['_trackPageview']);

    (function() {
     var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
     ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
         var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
       })();

    </script>

</body>
</html>