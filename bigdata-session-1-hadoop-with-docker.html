<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="HN, ">

        <link rel="alternate"  href="https://haridas.in/feeds/all.atom.xml" type="application/atom+xml" title="HN Full Atom Feed"/>

    <title>Bigdata Session 1 - Hadoop with docker // all posts // HN </title>


    <link href='https://fonts.googleapis.com/css?family=PT+Mono|PT+Serif|PT+Sans' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="https://haridas.in/theme/css/pure.css">
    <link rel="stylesheet" href="https://haridas.in/theme/css/asciidoctor.css">

    <link rel="stylesheet" href="https://haridas.in/theme/css/pygments.css">

    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/fitvids/1.2.0/jquery.fitvids.js"></script>
    <script>
        $(document).ready(function(){
            $(".content").fitVids();
        });
    </script>
</head>

<body>
    <div class="container">

            <div class="container-header">
            </div>


            <div class="container-body">

                    <div class="body-sidebar">
                        <header class="content-sidebar">

                            <hgroup>

                                <img class="avatar" src="https://haridas.in/images/profile_pic.jpg">

                                <h1 class="brand-main"><a href="https://haridas.in">HN</a></h1>


                                            <p class="links">
                                                <a href="https://haridas.in/category/programming.html">Programming
                                                </a>
                                            </p>
                                            <p class="links">
                                                <a href="https://haridas.in/category/data-science.html">Data-Science
                                                </a>
                                            </p>
                                            <p class="links">
                                                <a href="https://haridas.in/tag/security.html">Security
                                                </a>
                                            </p>
                                            <p class="links">
                                                <a href="https://haridas.in/category/devops.html">Devops
                                                </a>
                                            </p>
                                            <p class="links">
                                                <a href="https://haridas.in/pages/my-talks.html">Talks
                                                </a>
                                            </p>
                                            <p class="links">
                                                <a href="https://haridas.in/pages/about-me.html">About Me
                                                </a>
                                            </p>
                                            <p class="links">
                                                <a href="https://haridas.in/resume.pdf">Resume
                                                </a>
                                            </p>
                                <p class="social">
                                        <a href="https://twitter.com/haridas_n">
                                                <img src="https://haridas.in/images/tt.svg" alt="menu icon" width="48" height="48" />
                                        </a>
                                        <a href="https://github.com/haridas">
                                                <img src="https://haridas.in/images/github.svg" alt="menu icon" width="45" height="45" />
                                        </a>
                                        <a href="https://linkedin.com/in/haridasn">
                                                <img src="https://haridas.in/images/linkedin.svg" alt="menu icon" width="48" height="48" />
                                        </a>
                                </p>
                            </hgroup>
                    </header>

                    </div>


                    <div class="body-column">
    <div class="content">
        <div class="column">
            <section class="post">
                <header class="post-header">
                    <h1 class="article-title">Bigdata Session 1 - Hadoop with docker</h1>
                        <p class="post-meta">
                            Tags:                                 <a class="post-category" href="https://haridas.in/tag/hadoop.html">hadoop</a>
                                <a class="post-category" href="https://haridas.in/tag/yarn.html">yarn</a>
                                <a class="post-category" href="https://haridas.in/tag/hdfs.html">hdfs</a>
                        </p>


<a href="https://twitter.com/share" class="twitter-share-button" data-count="horizontal" data-via="haridas_n">
    Tweet
</a>

<script type="text/javascript" src="https://platform.twitter.com/widgets.js"></script>

<!-- Place this tag where you want the +1 button to render. -->
<div class="g-plusone" data-size="medium"></div>

<!-- Place this tag after the last +1 button tag. -->
<script type="text/javascript">
  (function() {
       var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
           po.src = 'https://apis.google.com/js/platform.js';
               var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
                 })();
</script>                        <p class="post-date">
                            in <a href="https://haridas.in/category/data-science.html">data-science</a> &middot; Sun 02 June 2019
                        </p>
                </header>
            </section>
            <div class="paragraph">
<p>This blog series includes 4 workshop sessions I conducted at Engineering colleges
and in my office.</p>
</div>
<div class="paragraph">
<p>Hadoop with docker is mainly used for easy prototype and learning purpose, also
it helps to set up quickly set up a Hadoop cluster on your laptop, or on multiple
machines.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Bigdata Session 1 - Apache Hadoop with docker &#8592; ( You are here now )</p>
</li>
<li>
<p>Bigdata Session 2 - Apache Spark on Apache Hadoop</p>
</li>
<li>
<p>Bigdata Session 3 - Apache Drill</p>
</li>
<li>
<p>Bigdata Session 4 - Apache Spark on Kubernetes</p>
</li>
</ol>
</div>
<div class="sect1">
<h2 id="_hadoop_cluster">1. Hadoop Cluster</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The main motive of the session is how we can easily test the Hadoop
cluster and related tools locally or on a small cluster. We will set up the Hadoop
in cluster mode. Hadoop cluster mode means, the individual components are runs
separately on a single machine on separate JVMs or running on multiple machines.</p>
</div>
<div class="paragraph">
<p>Here we will use the docker based setup to quickly play with the main
features of hadoop.</p>
</div>
<div class="paragraph">
<p>Main Hadoop services are:-</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>namenode ( storage )</p>
</li>
<li>
<p>datanode ( storage )</p>
</li>
<li>
<p>resource manager ( computation )</p>
</li>
<li>
<p>node manager ( computation )</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>One Hadoop cluster can be formed by one namenode and multiple datanodes.
The resource manager runs on the same machine as the namenode ( simpler setup).
The responsibility of the namenode is to store metadata about the distributed
filesystem (hdfs). Datanode actually stores the data in blob form,
and nodemanager will be running on each datanode to handle actual
computation requests from the resource manager.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_prerequisites">2. Prerequisites</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As in all cluster environments, network address resolution for each node is a key requirement
for a stable setup. Ideally, a local DNS setup that permanently allocates hostnames
to all the nodes in the network. Or we can manually set the hostnames without DNS.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
This material is verified on Mac and Ubuntu.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_jdk_1_8">2.1. JDK 1.8</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Not required if you try Docker-based setup.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Ensure you have jdk 1.8+ available on your machine, oracle jdk is
recommended.</p>
</div>
</div>
<div class="sect2">
<h3 id="_install_docker">2.2. Install Docker</h3>
<div class="paragraph">
<p>Ensure you have the latest version of docker is set up on your laptop.</p>
</div>
<div class="paragraph">
<p>Docker Version: <code>18.x.x</code></p>
</div>
<div class="sect4">
<h5 id="_for_ubuntu_debian_machines">For Ubuntu / Debian machines</h5>
<div class="paragraph">
<p>Follow this link and install the docker with a correct given bellow,</p>
</div>
<div class="paragraph">
<p><a href="https://docs.docker.com/install/linux/docker-ce/ubuntu/" class="bare">https://docs.docker.com/install/linux/docker-ce/ubuntu/</a></p>
</div>
</div>
<div class="sect4">
<h5 id="_for_mac">For Mac</h5>
<div class="paragraph">
<p><a href="https://docs.docker.com/docker-for-mac/install/" class="bare">https://docs.docker.com/docker-for-mac/install/</a></p>
</div>
<div class="paragraph">
<p>For other distros, please help yourself ;)</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_get_hadoop_docker_image">2.3. Get hadoop docker image</h3>

</div>
<div class="sect2">
<h3 id="_from_docker_hub">2.4. From docker hub</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">docker pull haridasn/hadoop-2.8.5:latest</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_build_the_docker_image_locally_optional">2.5. Build the docker image locally (Optional)</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">git clone https://github.com/haridas/hadoop-env
cd hadoop-env/docker
docker build -t hadoop-2.8.5:latest</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_set_correct_hostnames_for_multi_node_cluster_setup_optional">2.6. Set correct hostnames for multi-node cluster setup (Optional)</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If you are setting the cluster on the same machine with docker, you can skip this step.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Each node in the host machine can reach each other using the hostname.</p>
</div>
<div class="paragraph">
<p>Hadoop cluster setup using multiple physical machines.</p>
</div>
<div class="sect4">
<h5 id="_set_hostnames_correctly">set hostnames correctly.</h5>
<div class="paragraph">
<p>All the nodes place the same set of values.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">cat /etc/hosts
master  &lt;ip-address&gt;
node1
node2
node3
..
..</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_set_the_hostname_of_the_machine_to_match_this_address">Set the hostname of the machine to match this address.</h5>
<div class="paragraph">
<p>edit <code>/etc/hostname</code>
edit <code>/etc/hosts</code> and replace any occurrence of old hostname with a new one.</p>
</div>
</div>
<div class="sect4">
<h5 id="_update_and_check_hostname_changed_correctly">Update and check hostname changed correctly</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">sudo hostname &lt;hostname&gt;
hostname</code></pre>
</div>
</div>
<div class="paragraph">
<p>Cross-check all the machines have the correct set of hostnames before going to next
step.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_setup_cluster_on_a_single_machine_using_docker">3. Setup cluster on a single machine using docker</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We are using the docker container mainly for process isolation,
for a simpler
setup on a single machine we make use of the same network stack as the host machine.</p>
</div>
<div class="sect2">
<h3 id="_create_a_docker_network">3.1. Create a docker network</h3>
<div class="paragraph">
<p>For clean hostname resolution under docker environment, we have
to create a docker network; which will internally provide a DNS
resolution on the virtual network where all the containers reside.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">docker network create hadoop-nw</code></pre>
</div>
</div>
<div class="paragraph">
<p>We will use this network to launch all our containers, which will
internally allocate all the containers into this network. So we will
get the hostname resolution by default. For the non-docker deployment, we have
to set up all these externally.</p>
</div>
</div>
<div class="sect2">
<h3 id="_start_namenode_and_resource_manager">3.2. Start namenode and resource Manager</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>docker run -it -d --name namenode --network hadoop-nw haridasn/hadoop-2.8.5:latest namenode

# check container is running
docker ps -a

# Check container logs
docker logs -f namenode</code></pre>
</div>
</div>
<div class="paragraph">
<p>To get the <code>namenode</code> ip, attach to the namenode docker container,
We need this for starting the datanodes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">docker exec -it namenode bash
ifconfig</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_start_datanode_and_resource_manager">3.3. Start datanode and resource manager</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">docker run -it -d --name datanode1 \
    --network hadoop-nw haridasn/hadoop-2.8.5:latest datanode &lt;name-node-ip&gt;

docker ps -a

docker logs -f datanode1

.
# If you want to launch more datanodes.

docker run -it -d --name datanode2 \
    --network hadoop-nw haridasn/hadoop-2.8.5:latest datanode &lt;name-node-ip&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_get_the_client_tools_setup_on_another_docker">3.4. Get the client tools setup on another docker</h3>
<div class="paragraph">
<p>The <code>yarn</code>, <code>hdfs</code> client commands used to submit jobs and see the hdfs
files respectively are loaded in another docker. Let’s use that as our workbench
to play with our Hadoop cluster.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash"># Start the docker container to test our cluster.
docker run -it --rm --name hadoop-cli --network hadoop-nw haridasn/hadoop-cli:latest

# Get the configuration from running nodes.
docker cp namenode:/opt/hadoop/etc etc
docker cp etc hadoop-cli:/opt/hadoop/</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_check_hdfs">3.5. Check hdfs</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">./bin/hdfs dfs -ls /

# copy files into hdfs
./bin/hdfs dfs -put /var/log/supervisor /logs
./bin/hdfs dfs -put /etc/passwd /passwd

# Copy files inside hdfs
./bin/hdfs dfs -cp /passwd /passwdr</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_check_resource_manager_works_fine">3.6. Check Resource manager works fine</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">./bin/yarn jar `pwd`/share/hadoop/mapreduce/hadoop-mapreduce-examples-2.8.5.jar
pi 1 1

./bin/yarn jar `pwd`/share/hadoop/mapreduce/hadoop-mapreduce-examples-2.8.5.jar
wordcount /logs/ /out/</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_other_bigdata_tools_on_hadoop_environment">4. Other Bigdata tools on hadoop environment</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_pig">4.1. Pig</h3>
<div class="paragraph">
<p>A simpler command-oriented interface to do the map-reduce jobs over
Hadoop cluster. You can think of this as a bash scripting over hdfs
and yarn map-reduce to quickly analyze data on hdfs.</p>
</div>
<div class="sect4">
<h5 id="_download_and_extract_it">Download and extract it</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>wget http://mirrors.estointernet.in/apache/pig/pig-0.17.0/pig-0.17.0.tar.gz</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_setup_pig_and_configure_it_with_hadoop_cluster">Setup pig and configure it with hadoop cluster.</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">export PIG_HOME=&lt;path-to-pig-home&gt;
export PATH=$PATH:$PIG_HOME/bin
export PIG_CLASSPATH=&lt;path-to-hadoop-conf-dir&gt;

pig</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_load_some_data_into_hdfs">Load some data into hdfs</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">./bin/hdfs dfs -mkdir /pig
./bin/hdfs dfs -put pig/tutorial/data /pig/data</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_pig_commandline_tool">Pig commandline tool</h5>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>$ pig

raw = LOAD '/pig/data/excite-small.log' USING PigStorage('\t') AS (user, time,query);

user = filter raw by $2=='powwow.com';

dump user</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_hive">4.2. Hive</h3>
<div class="paragraph">
<p>SQL interface over the Hadoop system.</p>
</div>
<div class="paragraph">
<p><a href="http://mirrors.estointernet.in/apache/hive/hive-3.1.1/apache-hive-3.1.1-bin.tar.gz" class="bare">http://mirrors.estointernet.in/apache/hive/hive-3.1.1/apache-hive-3.1.1-bin.tar.gz</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_presentation">5. Presentation</h2>
<div class="sectionbody">
<iframe src="//www.slideshare.net/slideshow/embed_code/key/HKFon6Yn1cmXqa" width="595" height="485" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC; border-width:1px; margin-bottom:5px; max-width: 100%;" allowfullscreen> </iframe> <div style="margin-bottom:5px"> <strong> <a href="//www.slideshare.net/haridasnss/bigdata-and-hadoop-with-docker" title="Bigdata and Hadoop with Docker" target="_blank">Bigdata and Hadoop with Docker</a> </strong> from <strong><a href="https://www.slideshare.net/haridasnss" target="_blank">haridasnss</a></strong> </div>
</div>
</div>
            <a href="#" class="go-top">Go Top</a>
    <div class="comments">

        <!-- <div id="disqus_thread"></div> -->

        <div id="disqus_thread">
            <a href="#" class="comments-holder" onclick="loadDisqus();return false;">Show/Post Comments</a> 
        </div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = "haridas"; // required: replace example with your forum shortname

            /* * * DON'T EDIT BELOW THIS LINE * * */
            var loadDisqus = function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            };
        </script>

        <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

    </div>
        </div>
    </div>
                    </div>

            </div>

            <div class="container-footer">
<footer class="footer">
                <a href="https://twitter.com/haridas_n"> Twitter</a> |
                <a href="https://github.com/haridas"> Github</a> |
                <a href="https://linkedin.com/in/haridasn"> Linkedin</a>
        &ndash;
        &copy; HN &ndash;
        <i> <a href="https://github.com/haridas/hn-theme">Built with HN Theme</a> </i>
        for <a href="https://blog.getpelican.com/">Pelican</a>
</footer>            </div>

    </div>

    <script>
        var $top = $('.go-top');

        // Show or hide the sticky footer button
        $(window).scroll(function() {
            if ($(this).scrollTop() > 200) {
                $top.fadeIn(200);
            } else {
                $top.fadeOut(200);
            }
        });

        // Animate the scroll to top
        $top.click(function(event) {
            event.preventDefault();
            $('html, body').animate({scrollTop: 0}, 300);
        })

        // Makes sure that the href="#" attached to the <a> elements
        // don't scroll you back up the page.
        $('body').on('click', 'a[href="#"]', function(event) {
            event.preventDefault();
        });
    </script>
    <script type="text/javascript">

      var _gaq = _gaq || [];
          _gaq.push(['_setAccount', 'UA-23592173-1']);
          _gaq.push(['_trackPageview']);

    (function() {
     var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
     ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
         var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
       })();

    </script>

</body>
</html>